<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>基盤構築・デプロイの自動化 &#8212; mynavi-doc-draft 1.0.0.SNAPSHOT ドキュメント</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="prev" title="マイナビ記事原稿ドラフト" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          mynavi-doc-draft</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">基盤構築・デプロイの自動化</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">基盤構築・デプロイの自動化</a><ul>
<li><a class="reference internal" href="#id2">はじめに</a></li>
<li><a class="reference internal" href="#id7">基盤構築自動化の発展経緯</a></li>
<li><a class="reference internal" href="#id10">継続的インテグレーション、継続的デリバリの発展</a></li>
<li><a class="reference internal" href="#id11">マイクロサービスにおける基盤自動化・継続的インテグレーション・デリバリ</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: マイナビ記事原稿ドラフト"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; マイナビ記事原稿ドラフト</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/automation_infra_devops_overview.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="section-automation-infra-devops-overview-label">
<span id="id1"></span><h1><a class="toc-backref" href="#id12">基盤構築・デプロイの自動化</a><a class="headerlink" href="#section-automation-infra-devops-overview-label" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id13">はじめに</a><a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>本章では基盤・デプロイの自動化に関する最近の動向および、
基盤自動化・継続的インテグレーション・デリバリを実際に実現する例について概要を説明する。本章は以下の構成から成る。</p>
<div class="contents topic" id="id3">
<p class="topic-title first">本章の構成</p>
<ul class="simple">
<li><a class="reference internal" href="#section-automation-infra-devops-overview-label" id="id12">基盤構築・デプロイの自動化</a><ul>
<li><a class="reference internal" href="#id2" id="id13">はじめに</a></li>
<li><a class="reference internal" href="#id7" id="id14">基盤構築自動化の発展経緯</a></li>
<li><a class="reference internal" href="#id10" id="id15">継続的インテグレーション、継続的デリバリの発展</a></li>
<li><a class="reference internal" href="#id11" id="id16">マイクロサービスにおける基盤自動化・継続的インテグレーション・デリバリ</a></li>
</ul>
</li>
</ul>
</div>
<p>まず最初に基盤自動化、継続的インテグレーション・デリバリの発展経緯を記載し、近年の動向を整理する。
その後、マイクロサービスアーキテクチャに基づいた実現例の概要を述べる。
実際のアプリケーション構成や想定する基盤の環境、一連のリリースサイクルを具体化して記述するが、実際の設定や実装について次回以降、詳述していく。
なお、次回以降は以下のような章構成の予定である。</p>
<ul class="simple">
<li>第1回：[概要編] 基盤・デプロイ自動化の発展経緯・最近の動向・事例(本章)</li>
<li>第2回：[実践編] 前準備 <a class="reference external" href="https://github.com/debugroom/sample-aws-ecs">ECSを前提としたマイクロサービスアプリケーション基本構成・実装例</a></li>
<li>第3回：[実践編] AWSにおけるCI/CD構築例その1 <a class="reference external" href="https://github.com/debugroom/sample-aws-codebuild">AWS CodeBuildの実装</a> ・ <a class="reference external" href="https://debugroom.github.io/doc/cloud/aws/article/devops.html#codebuild">AWS CodeBuildの設定例</a></li>
<li>第4回：[実践編] AWSにおけるCI/CD構築例その2 <a class="reference external" href="https://github.com/debugroom/sample-aws-codepipeline">AWS CodePipelineの実装</a>  ・ <a class="reference external" href="https://debugroom.github.io/doc/cloud/aws/article/devops.html#codepipeline">AWS CodePipelineの設定例</a></li>
<li>第5回：[実践編] AWSにおける基盤自動化 AWS CloudFormationの実装例・設定例</li>
<li>[別途整理中：付録] <a class="reference external" href="https://github.com/debugroom/mynavi-ib-monolithic">モノリシック</a> ・マイクロサービスアプリケーションの設計・実装の比較(インターネットバンキングを例にして考察)</li>
</ul>
<p><br/></p>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id14">基盤構築自動化の発展経緯</a><a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><br/>
ロードバランサやアプリケーションサーバ、データベースサーバ、監視サーバといったアプリケーション実行基盤を
自動構築するニーズは、仮想化技術の進展とともに、Amazon Web ServiceといったIaaSや、
Openstackなどのクラウドコンピューティングオープンソースソフトウェアの登場により高まりをみせてきた。</p>
<p>従来、企業が自社のデータセンタへ各々サーバを構成し、環境を構築する場合は一度環境を作ってしまえば、その後、ゼロから作り替えたりするケースは稀であった。
しかし、IaaSなどのクラウド環境で、仮想マシン上にゲストOSを <a class="reference external" href="https://ja.wikipedia.org/wiki/%E3%83%97%E3%83%AD%E3%83%93%E3%82%B8%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0">プロビジョニング</a> して環境を構築する形になると、
繰り返し、同一の実行基盤サーバ設定、環境を構築することになる。また、オートスケールなど、サーバリソースを動的に増減できることは、
環境の新規構築・破棄が自動で行われ、 <a class="reference external" href="https://ja.wikipedia.org/wiki/Immutable_Infrastructure">イミュータブルインフラストラクチャ</a> といった概念(一度サーバ環境を構築した後は、特に変更など加えず、破棄して新しく作り変える考え方)で、
アプリケーション実行環境構築手法に新たな考え方をもたらしている。こうした背景のもと、
環境構築の作業品質や実行スピードの向上を目的に、基盤構築作業をコード化して実行すること(Infrastructure As Code)により、
サーバ・ミドルウェア環境を自動構築できる、「Puppet」、「Ansible」、「Chef」といった構成管理ツールが普及していくようになる。</p>
<p>一方、仮想化技術は発展を続け、OSを丸ごと実行するハイパーバイザ型と比べて、ハードウェアリソースの消費コストが小さい
Dockerなどのコンテナ技術が発達し、近年広く普及しつつある。また、Kubernetesなどの
コンテナのリソース管理・スケール調整などを行い、大規模なコンテナアプリケーション実行環境を管理する
オーケストレションツールが脚光を浴びている。このようなアプリケーション実行環境全体の包括的な
Infrastructure As Codeのツールとして、「Amazon Cloud Formation」や「Terraform」を使った
基盤構築のコード化が近年のトレンドとなっている。</p>
<p><br/></p>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id15">継続的インテグレーション、継続的デリバリの発展</a><a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><br/></p>
<p>他方、継続的インテグレーション(Continuous Integration:CI)・継続的デリバリ(Continuous Delivery:CD)では、
オープンソースソフトウェアのJenkinsを中心として、</p>
<ol class="arabic simple">
<li>GitHubなどのソースコードチェックアウト</li>
<li>Maven/Gradleなどのビルドツールの実行</li>
<li>JUnitなどのテストコードを用いたテスト実行</li>
<li>静的解析ツールを用いたインスペクション</li>
<li>商用環境サーバやライブラリ管理ツールへのデプロイ</li>
</ol>
<p>といった一連のソフトウェア開発・リリースサイクルを自動化する手法が主流として発展してきたが、
こちらも仮想化技術やコンテナ技術の普及により、ベアメタルサーバをベースとした単一のサーバ環境だけに留まらなくなってきている。
また、ブルーグリーンデプロイメントといった、クラウド環境のメリットを生かして、ローリングアップデートするリリース手法に加え、
マルチコンテナ化により複雑化するCI/CD実行環境からステージング環境・プロダクション環境への一連のリリースサイクルをパイプライン化して可視化する、
AWS CodePipelineなどのツールも活用の機会が増えつつある。</p>
<p><br/></p>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id16">マイクロサービスにおける基盤自動化・継続的インテグレーション・デリバリ</a><a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><br/></p>
<p>こうした状況の中で、疎結合性・独立性を重視し、開発のアジリティを向上させるマイクロサービスアーキテクチャが
基盤構築の自動化・継続的インテグレーションにも変化をもたらしている。というのも、従来のモノリシックなアプリケーション
(全ての機能が一つのアプリケーションパッケージにまとまっている形)に比べ、アプリケーション構成はもとより、
チーム間での開発体制からリリースの単位までこれまでとは異なる形で行うことを要求されるからである。
マイクロサービスアーキテクチャでは、サービス間で影響を局所化し、開発におけるアジリティ向上を実現するために、
以下のようにアプリケーションを構成・開発することが要求されるケースが多い。</p>
<ul class="simple">
<li>アプリケーションは複数のマイクロサービスで構成する。各サービス単位にチームが分けられ、リリース・デプロイまでの開発プロセスを独立して構築する。</li>
<li>多数のサービスはコンテナをベースに構築され、各サービスそれぞれがスケーリング可能な形でデプロイされる。</li>
</ul>
<p>こうした近年のトレンドに基づき、マイクロサービスアーキテクチャのアプリケーション構成、基盤自動化/継続的インテグレーション・デリバリを実現する例を実際に構築してみよう。</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/MicroServiceArchitecture.png"><img alt="_images/MicroServiceArchitecture.png" src="_images/MicroServiceArchitecture.png" style="width: 786.0px; height: 951.0px;" /></a>
</div>
<p>[アプリケーションの構成]</p>
<ul class="simple">
<li>アプリケーションはAmazon Web Service上に構築するWebアプリケーションとする。</li>
<li>アプリケーションはフロントエンドとバックエンドのサービスに分割し、各サービスはAWS ECSコンテナ上にデプロイされるものとする。</li>
<li>ECSコンテナ内の各サービスは組み込みTomcatを内蔵するSpringBootアプリケーションで実装する。</li>
<li>各サービス間はRESTベースのHTTPリクエストでメッセージ通信を行い、ApplicationLoadBalancerを介して負荷分散する。</li>
</ul>
<p>なお、サービスをフロントエンドとバックエンドに分割するのは以下の理由・目的のためである。</p>
<p>[フロントエンドの役割]</p>
<ul class="simple">
<li>サービスマッピング(IP・ポート)</li>
<li>ブラウザからHTTPメソッド変換(GET・POST⇔GET・POST・PUT・DELETE・OPTION)</li>
<li>セッション共有(キャッシュサーバ)</li>
<li><dl class="first docutils">
<dt>セキュリティ</dt>
<dd><ul class="first last">
<li>認証・認可</li>
<li>入力チェック</li>
<li>バックエンドサービスURIの隠蔽</li>
<li>クライアント⇔バックエンドの直接アクセス禁止</li>
</ul>
</dd>
</dl>
</li>
<li>クラウド依存処理の集約(S3アクセス等)</li>
</ul>
<p>[バックエンドの役割]</p>
<ul class="simple">
<li>RESTfulアーキテクチャインターフェース(GET/POST/PUT/DELETE/OPTIONS)</li>
<li>Resource Base URI (/api/v1/users/1)</li>
<li>冪等性の実現</li>
<li>ステートレスの実現</li>
<li>データベースなどセキュリティ的に保護する必要があるリソースへのアクセス</li>
</ul>
<p>また、サービスがECSコンテナにより管理、ApplicationLoadBalancerを介することで、以下の面がカバーされるようになる。</p>
<ul class="simple">
<li>ヘルスチェックによるサービス監視</li>
<li>サービスディスカバリ(ヘルスチェックでNGだと再起動)</li>
<li>ロードバランシング</li>
<li>ハードリソース調整/監視(CloudWatch)</li>
<li>パスベースルーティング</li>
</ul>
<p>こうしたアプリケーション実行環境の構成は、AWS CloudFormationやTerraformを使って自動構築することができる。
次回以降、SpringBootを使用したアプリケーションの構成や実装、Cloud Formationによる基盤構築の自動化の具体例について詳述していく。</p>
<p>DevOpsとして、下記のように、各サービスを構成するマルチコンテナ環境下でのステージング・
プロダクション環境へのデプロイまでの一連のサイクルを可視化するパイプラインを構成する。</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/ContinuousDeployment.png"><img alt="_images/ContinuousDeployment.png" src="_images/ContinuousDeployment.png" style="width: 1011.0px; height: 461.0px;" /></a>
</div>
<p>AWS CodePipelineを用いて、GitHub上のDevelopブランチへソースコードをコミットもしくはプルリクエストに対し、
AWS CodeBuildを使って、ビルド・テスト・インスペクションを実行し、コンテナイメージを作成して、DockerHub上へプッシュ、
アプリケーションをステージング環境のAWS ECSへデプロイさせる一連の流れを自動化・可視化する。</p>
<p>ステージング環境での検証の後、改めてGitHubのMasterブランチへソースコードをコミットもしくはプルリクエストに対し、
同様にプロダクション環境へのリリースを自動化して行う。</p>
<p>こちらも同様に、次回以降、各プロダクトの設定の要領やポイントについて詳述する。</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, kohei.kawabata.<br/>
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6 で生成しました。<br/>
    </p>
  </div>
</footer>
  </body>
</html>